<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
	- Web Application Context definition for "Simpleinquest" DispatcherServlet.
-->
<beans>

	<bean id="dataBase" class="org.springmodules.db.hsqldb.ServerBean" singleton="true" lazy-init="false">
		<property name="configBeanResource" ref="configBeanResource"/>
    	<property name="dataSource"><ref local="myDataSource"/></property>
        <property name="serverProperties">
        	<props>
            	<prop key="server.port">9003</prop>
                <prop key="server.database.0">/db/simpleDB</prop>
                <prop key="server.dbname.0">simpleDB</prop>
            </props>
        </property>
    </bean>

	<bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource">
   		<property name="driverClassName" value="org.hsqldb.jdbcDriver" />
   		<property name="url" value="jdbc:hsqldb:hsql://localhost:9003/simpleDB" />
   		<property name="username" value="sa" />
   		<property name="password" value="" />
	</bean>

	<bean id="mySessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
      	<property name="dataSource" ref="myDataSource" />
      	<property name="configLocation">
         	<value>classpath:hibernate.cfg.xml</value>
      	</property>
   	</bean>
   	
   	<bean id="customDateEditor"
     	class="org.springframework.beans.propertyeditors.CustomDateEditor">
    	<constructor-arg >
      		<bean class="java.text.SimpleDateFormat">
        		<constructor-arg><value>dd.MM.yyyy HH:mm</value></constructor-arg>
      		</bean>
    	</constructor-arg>
    	<constructor-arg ><value>true</value></constructor-arg>
  	</bean>

	<bean id="myTxManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="mySessionFactory" />
	</bean>
	
	<!-- Controller -->	
	<bean id="userController" class="de.u808.simpleinquest.web.usermanagement.UserController">
		<property name="userManager" ref="userManager"/>
	</bean>
	
	<!-- Manager -->	
	<bean id="userManager" class="de.u808.simpleinquest.service.impl.HibernateUserManager">
		<property name="userDAO" ref="userDAO"/>
	</bean>
	
	<bean id="searchManager" class="de.u808.simpleinquest.service.search.SearchManager">
		<property name="indexSearchBean" ref="indexSearchBean"/>
	</bean>
	
	<bean id="indexSearchBean" class="de.u808.simpleinquest.service.search.IndexSearchBean" depends-on="configBeanResource">
		<property name="configBeanResource" ref="configBeanResource"/>
	</bean>
	
	<!-- Forms -->
	<bean id="userEditController"
		class="de.u808.simpleinquest.web.usermanagement.UserEditController">
		<property name="userManager" ref="userManager"/>
		<property name="formView" value="userForm"/>
		<property name="successView" value="redirect:userList.htm"/>
	</bean>
	
	<bean id="searchController" class="de.u808.simpleinquest.web.search.SearchController">
		<property name="searchManager" ref="searchManager"/>
		<property name="formView" value="searchForm"/>
		<property name="successView" value="self"/>
	</bean>
	
	
	<!-- DAOs -->
	<bean id="userDAO" class="de.u808.simpleinquest.repository.impl.UserDAOImpl">
		<property name="sessionFactory" ref="mySessionFactory"/>
	</bean>
	
	<!-- Resources -->
	<bean id="configBeanResource" class="de.u808.simpleinquest.web.ConfigBeanResource">
		<constructor-arg value="../SimpleInquestConf.xml"/>
	</bean>
	
</beans>
